<style>
/* ========================================== */
/* PODCAST ESTILO SPOTIFY */
/* ========================================== */

.spotify-podcast-page {
    background: linear-gradient(180deg, rgba(34, 197, 94, 0.15) 0%, rgba(17, 24, 39, 0.95) 300px);
    min-height: 100vh;
    padding: 0;
}

/* Header do Podcast */
.spotify-podcast-header {
    display: flex;
    align-items: flex-end;
    gap: 2rem;
    padding: 2rem 2rem 1.5rem;
    margin-bottom: 1.5rem;
}

.spotify-podcast-cover {
    width: 232px;
    height: 232px;
    min-width: 232px;
    border-radius: 4px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    object-fit: cover;
}

.spotify-podcast-info {
    flex: 1;
    min-width: 0;
}

.spotify-podcast-type {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    color: white;
    margin-bottom: 0.5rem;
    letter-spacing: 0.1em;
}

.spotify-podcast-title {
    font-size: 3rem;
    font-weight: 900;
    color: white;
    margin-bottom: 0.5rem;
    line-height: 1.2;
    word-break: break-word;
}

.spotify-podcast-author {
    color: white;
    font-size: 0.875rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.spotify-podcast-description {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.875rem;
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Actions */
.spotify-podcast-actions {
    padding: 1.5rem 2rem;
    display: flex;
    align-items: center;
    gap: 2rem;
}

.spotify-play-button {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: #22c55e;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 16px rgba(34, 197, 94, 0.4);
}

.spotify-play-button:hover {
    transform: scale(1.06);
    background: #16a34a;
    box-shadow: 0 6px 24px rgba(34, 197, 94, 0.6);
}

.spotify-play-button i {
    font-size: 24px;
    color: white;
    margin-left: 3px;
}

.spotify-icon-button {
    width: 32px;
    height: 32px;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.spotify-icon-button:hover {
    color: white;
    transform: scale(1.06);
}

.spotify-icon-button.active {
    color: #22c55e;
}

/* Lista de Epis√≥dios - Estilo Spotify */
.spotify-episodes-container {
    padding: 0 2rem 2rem;
}

.spotify-episode-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    border-radius: 4px;
    transition: background-color 0.2s ease;
    cursor: pointer;
    margin-bottom: 0.5rem;
}

.spotify-episode-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.spotify-episode-thumbnail {
    width: 112px;
    height: 112px;
    min-width: 112px;
    border-radius: 4px;
    object-fit: cover;
}

.spotify-episode-content {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
}

.spotify-episode-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 0.5rem;
}

.spotify-episode-title {
    color: white;
    font-size: 1rem;
    font-weight: 500;
    margin-bottom: 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.spotify-episode-play-button {
    width: 40px;
    height: 40px;
    min-width: 40px;
    border-radius: 50%;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.7);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    opacity: 0;
}

.spotify-episode-item:hover .spotify-episode-play-button {
    opacity: 1;
}

.spotify-episode-play-button:hover {
    transform: scale(1.06);
    border-color: white;
    background: rgba(255, 255, 255, 0.1);
}

.spotify-episode-play-button i {
    font-size: 16px;
    margin-left: 2px;
}

.spotify-episode-description {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
    margin-bottom: 0.75rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.spotify-episode-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: rgba(255, 255, 255, 0.6);
}

.spotify-episode-dot {
    width: 4px;
    height: 4px;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 50%;
}

/* Loading State */
.spotify-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 4rem 2rem;
    color: rgba(255, 255, 255, 0.6);
}

.spotify-loading i {
    font-size: 2rem;
    color: #22c55e;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Responsivo */
/* ========================================== */
/* RESPONSIVIDADE COMPLETA - Podcasts */
/* ========================================== */

/* Mobile Muito Pequeno (at√© 480px) */
@media (max-width: 480px) {
    .spotify-podcast-page {
        padding: 0;
    }
    
    .spotify-podcast-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 1rem;
        padding: 1.5rem 1rem 1rem;
        margin-bottom: 1rem;
    }
    
    .spotify-podcast-cover {
        width: 140px;
        height: 140px;
    }
    
    .spotify-podcast-type {
        font-size: 0.625rem;
    }
    
    .spotify-podcast-title {
        font-size: 1.5rem;
        line-height: 1.3;
    }
    
    .spotify-podcast-author,
    .spotify-podcast-description {
        font-size: 0.75rem;
    }
    
    .spotify-podcast-actions {
        padding: 1rem;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .spotify-play-button {
        width: 48px;
        height: 48px;
    }
    
    .spotify-play-button i {
        font-size: 20px;
    }
    
    .spotify-icon-button {
        width: 28px;
        height: 28px;
        font-size: 28px;
    }
    
    /* Epis√≥dios - Mobile */
    .spotify-episodes-container {
        padding: 0 0.5rem 1rem;
    }
    
    .spotify-episode-item {
        flex-direction: column;
        gap: 0.75rem;
        padding: 0.75rem;
    }
    
    .spotify-episode-thumbnail {
        width: 100%;
        height: auto;
        min-width: auto;
    }
    
    .spotify-episode-content {
        max-width: 100%;
    }
    
    .spotify-episode-title {
        font-size: 0.875rem;
        -webkit-line-clamp: 2;
        line-clamp: 2;
    }
    
    .spotify-episode-description {
        font-size: 0.75rem;
        -webkit-line-clamp: 2;
        line-clamp: 2;
    }
    
    .spotify-episode-meta {
        font-size: 0.7rem;
    }
    
    .spotify-episode-play-button {
        width: 36px;
        height: 36px;
        min-width: 36px;
    }
}

/* Mobile Normal (481px - 768px) */
@media (min-width: 481px) and (max-width: 768px) {
    .spotify-podcast-header {
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 1.25rem;
        padding: 1.75rem 1.5rem 1.25rem;
    }
    
    .spotify-podcast-cover {
        width: 180px;
        height: 180px;
    }
    
    .spotify-podcast-type {
        font-size: 0.7rem;
    }
    
    .spotify-podcast-title {
        font-size: 2rem;
    }
    
    .spotify-podcast-author,
    .spotify-podcast-description {
        font-size: 0.8rem;
    }
    
    .spotify-podcast-actions {
        padding: 1.25rem 1.5rem;
        gap: 1.5rem;
    }
    
    .spotify-play-button {
        width: 52px;
        height: 52px;
    }
    
    /* Epis√≥dios ajustados */
    .spotify-episodes-container {
        padding: 0 1rem 1.5rem;
    }
    
    .spotify-episode-item {
        gap: 0.875rem;
        padding: 0.875rem;
    }
    
    .spotify-episode-thumbnail {
        width: 100px;
        height: 100px;
        min-width: 100px;
    }
    
    .spotify-episode-content {
        max-width: calc(100% - 100px - 0.875rem);
    }
    
    .spotify-episode-title {
        font-size: 0.9375rem;
        -webkit-line-clamp: 2;
        line-clamp: 2;
    }
    
    .spotify-episode-description {
        font-size: 0.8125rem;
        -webkit-line-clamp: 2;
        line-clamp: 2;
    }
}

/* Tablet (769px - 1024px) */
@media (min-width: 769px) and (max-width: 1024px) {
    .spotify-podcast-cover {
        width: 200px;
        height: 200px;
    }
    
    .spotify-podcast-title {
        font-size: 2.5rem;
    }
    
    .spotify-episodes-container {
        padding: 0 1.5rem 1.5rem;
    }
    
    .spotify-episode-thumbnail {
        width: 112px;
        height: 112px;
    }
    
    .spotify-episode-content {
        max-width: calc(100% - 112px - 1rem);
    }
    
    .spotify-episode-title {
        -webkit-line-clamp: 2;
        line-clamp: 2;
    }
    
    .spotify-episode-description {
        -webkit-line-clamp: 2;
        line-clamp: 2;
    }
}
</style>

<div class="spotify-podcast-page" 
     data-podcast-id="{{ podcast.browseId if podcast else '' }}"
     x-data="{
    podcastId: '',
    podcast: null,
    episodes: [],
    loading: true,
    
    init() {
        // Pegar ID do podcast
        this.podcastId = this.$el.getAttribute('data-podcast-id');
        console.log('üéôÔ∏è Carregando podcast:', this.podcastId);
        
        // Carregar dados do podcast
        this.loadPodcast();
    },
    
    async loadPodcast() {
        if (!this.podcastId) {
            console.error('‚ùå ID do podcast n√£o encontrado');
            this.loading = false;
            return;
        }
        
        try {
            // ‚ö° CARREGAR EM PARALELO para ser mais r√°pido
            const [podcastRes, episodesRes] = await Promise.all([
                fetch('/api/podcast/' + this.podcastId),
                fetch('/api/podcast/' + this.podcastId + '/episodes')
            ]);
            
            const [podcastData, episodesData] = await Promise.all([
                podcastRes.json(),
                episodesRes.json()
            ]);
            
            // Processar dados do podcast
            if (podcastData.success) {
                this.podcast = podcastData.podcast;
                console.log('‚úÖ Podcast carregado:', this.podcast.title);
            } else {
                console.error('‚ùå Erro:', podcastData.error);
            }
            
            // Processar epis√≥dios
            if (episodesData.success) {
                this.episodes = episodesData.episodes || [];
                console.log('‚úÖ Epis√≥dios carregados:', this.episodes.length);
            } else {
                console.error('‚ùå Erro ao carregar epis√≥dios:', episodesData.error);
                this.episodes = []; // Garantir que seja array vazio
            }
            
        } catch (error) {
            console.error('‚ùå Erro ao carregar podcast:', error);
            this.episodes = []; // Garantir que episodes seja sempre um array
            this.podcast = null;
        } finally {
            this.loading = false;
        }
    },
    
    getHighResThumbnail(url) {
        if (!url) return '/static/images/placeholder.jpg';
        return '/api/image-proxy?url=' + encodeURIComponent(url);
    },
    
    playEpisode(episode, index) {
        if (episode.videoId && window.Alpine && Alpine.store('player')) {
            // ‚ö° DEFINIR FILA COM TODOS OS EPIS√ìDIOS
            Alpine.store('player').setQueue(this.episodes);
            
            const episodeData = {
                videoId: episode.videoId,
                title: episode.title,
                artist: this.podcast ? this.podcast.title : 'Podcast',
                thumbnails: episode.thumbnails || (this.podcast ? this.podcast.thumbnails : [])
            };
            
            Alpine.store('player').playTrack(episodeData);
            console.log('üéôÔ∏è Tocando epis√≥dio', index + 1, 'de', this.episodes.length);
        }
    },
    
    playPodcast() {
        if (this.episodes && this.episodes.length > 0) {
            this.playEpisode(this.episodes[0], 0);
        }
    }
}">

    <!-- Loading -->
    <div x-show="loading" class="spotify-loading">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Carregando podcast...</span>
    </div>

    <!-- Content -->
    <div x-show="!loading && podcast" style="display: none;">
        <!-- Header -->
        <header class="spotify-podcast-header">
            <!-- Capa -->
            <img :src="podcast && podcast.thumbnails && podcast.thumbnails[0] ? getHighResThumbnail(podcast.thumbnails[0].url) : '/static/images/placeholder.jpg'"
                 :alt="podcast ? podcast.title : 'Podcast'"
                 class="spotify-podcast-cover"
             onerror="if(this.src !== '/static/images/placeholder.jpg') { this.src='/static/images/placeholder.jpg'; this.onerror=null; }">
            
            <!-- Info -->
            <div class="spotify-podcast-info">
                <p class="spotify-podcast-type">Podcast</p>
                <h1 class="spotify-podcast-title" x-text="podcast ? podcast.title : 'Podcast'"></h1>
                <p class="spotify-podcast-author" x-text="podcast && podcast.author ? podcast.author.name : 'Autor'"></p>
                <p class="spotify-podcast-description" x-show="podcast && podcast.description" x-text="podcast ? podcast.description : ''"></p>
            </div>
        </header>
        
        <!-- Actions -->
        <div class="spotify-podcast-actions">
            <button class="spotify-play-button" @click="playPodcast()">
                <i class="fas fa-play"></i>
            </button>
            <button class="spotify-icon-button">
                <i class="fas fa-bell"></i>
            </button>
            <button class="spotify-icon-button">
                <i class="fas fa-ellipsis-h"></i>
            </button>
        </div>
        
        <!-- Episodes List -->
        <div class="spotify-episodes-container">
            <!-- Loading Episodes -->
            <div x-show="episodes.length === 0" class="spotify-loading" style="padding: 2rem;">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Carregando epis√≥dios...</span>
            </div>
            
            <!-- Episodes -->
            <div x-show="episodes.length > 0" style="display: none;">
                <template x-for="(episode, index) in (episodes || [])" :key="'episode-' + index">
                    <div class="spotify-episode-item" @click="playEpisode(episode, index)">
                        <!-- Thumbnail -->
                        <img :src="episode.thumbnails && episode.thumbnails[0] ? getHighResThumbnail(episode.thumbnails[0].url) : (podcast && podcast.thumbnails && podcast.thumbnails[0] ? getHighResThumbnail(podcast.thumbnails[0].url) : '/static/images/placeholder.jpg')"
                             :alt="episode.title"
                             class="spotify-episode-thumbnail"
                             onerror="if(this.src !== '/static/images/placeholder.jpg') { this.src='/static/images/placeholder.jpg'; this.onerror=null; }">
                        
                        <!-- Content -->
                        <div class="spotify-episode-content">
                            <div class="spotify-episode-header">
                                <div style="flex: 1; min-width: 0;">
                                    <h3 class="spotify-episode-title" x-text="episode.title"></h3>
                                    <p class="spotify-episode-description" x-show="episode.description" x-text="episode.description"></p>
                                    <div class="spotify-episode-meta">
                                        <span x-show="episode.date" x-text="episode.date"></span>
                                        <span x-show="episode.date && episode.duration" class="spotify-episode-dot"></span>
                                        <span x-show="episode.duration" x-text="episode.duration"></span>
                                    </div>
                                </div>
                                <button class="spotify-episode-play-button" @click.stop="playEpisode(episode, index)">
                                    <i class="fas fa-play"></i>
                </button>
            </div>
        </div>
                    </div>
                </template>
            </div>
        </div>
        </div>

</div>
